import { useSession } from 'next-auth/react'
import { api } from '~/utils/api'

const table = [
  [20, 7.5, 12.5, 15, 17.5, 17.5],
  [22, 10, 12.5, 15, 17.5, 20],
  [31, 12.5, 17.5, 22.5, 25, 27.5],
  [34, 12.5, 20, 22.5, 27.5, 30],
  [36, 15, 20, 25, 30, 32.5],
  [38, 15, 22.5, 27.5, 30, 35],
  [40, 15, 22.5, 27.5, 32.5, 37.5],
  [43, 17.5, 25, 30, 35, 40],
  [45, 17.5, 25, 30, 37.5, 40],
  [47, 17.5, 27.5, 32.5, 37.5, 42.5],
  [49, 20, 27.5, 35, 40, 45],
  [52, 20, 30, 35, 42.5, 47.5],
  [54, 22.5, 30, 37.5, 42.5, 50],
  [56, 22.5, 32.5, 37.5, 45, 52.5],
  [58, 22.5, 32.5, 40, 47.5, 52.5],
  [61, 25, 35, 42.5, 50, 55],
  [63, 25, 37.5, 42.5, 50, 57.5],
  [65, 25, 37.5, 45, 52.5, 60],
  [68, 27.5, 40, 47.5, 55, 60],
  [70, 27.5, 40, 47.5, 57.5, 62.5],
  [72, 27.5, 40, 50, 60, 65],
  [74, 30, 42.5, 50, 60, 67.5],
  [77, 30, 42.5, 52.5, 60, 70],
  [79, 32.5, 45, 55, 62.5, 72.5],
  [81, 32.5, 47.5, 55, 65, 72.5],
  [83, 32.5, 47.5, 57.5, 67.5, 75],
  [86, 35, 50, 60, 67.5, 77.5],
  [88, 35, 50, 60, 70, 80],
  [90, 37.5, 52.5, 60, 72.5, 82.5],
  [92, 37.5, 52.5, 62.5, 75, 85],
  [95, 37.5, 55, 65, 77.5, 85],
  [97, 37.5, 57.5, 65, 77.5, 87.5],
  [99, 37.5, 57.5, 67.5, 80, 90],
  [102, 40, 60, 70, 82.5, 92.5],
  [104, 40, 60, 70, 85, 92.5],
  [106, 40, 60, 72.5, 85, 95],
  [108, 42.5, 60, 75, 85, 97.5],
  [111, 42.5, 62.5, 75, 87.5, 100],
  [113, 45, 65, 77.5, 90, 102.5],
  [115, 42.5, 60, 80, 92.5, 107.5],
  [117, 45, 60, 82.5, 95, 110],
  [120, 45, 62.5, 85, 97.5, 110],
  [122, 47.5, 62.5, 85, 100, 112.5],
  [124, 47.5, 65, 85, 102.5, 115],
  [127, 47.5, 65, 87.5, 102.5, 117.5],
  [129, 50, 67.5, 87.5, 105, 120],
  [131, 50, 67.5, 90, 107.5, 122.5],
  [133, 50, 70, 92.5, 110, 125],
  [136, 52.5, 70, 92.5, 110, 127.5],
  [138, 52.5, 72.5, 95, 110, 130],
  [140, 55, 72.5, 97.5, 112.5, 132.5],
  [142, 55, 75, 97.5, 115, 135],
  [145, 55, 75, 100, 117.5, 135],
  [147, 57.5, 77.5, 102.5, 120, 135],
  [149, 57.5, 77.5, 105, 120, 137.5],
  [151, 57.5, 80, 105, 122.5, 140],
  [154, 60, 80, 107.5, 125, 142.5],
  [156, 60, 82.5, 110, 127.5, 145],
  [158, 52.5, 80, 105, 117.5, 132.5, 145],
  [161, 52.5, 82.5, 105, 120, 135, 147.5],
  [163, 55, 82.5, 107.5, 120, 135, 150],
  [165, 55, 85, 107.5, 122.5, 137.5, 152.5],
  [167, 55, 85, 110, 125, 137.5, 155],
  [170, 57.5, 85, 110, 127.5, 140, 157.5],
  [172, 57.5, 85, 110, 127.5, 142.5, 160],
  [174, 57.5, 87.5, 112.5, 130, 145, 160],
  [176, 60, 87.5, 115, 132.5, 147.5, 160],
  [179, 60, 90, 115, 132.5, 150, 162.5],
  [181, 60, 90, 117.5, 135, 150, 165],
  [183, 60, 92.5, 120, 135, 152.5, 167.5],
  [185, 60, 92.5, 120, 137.5, 155, 170],
  [188, 60, 95, 122.5, 137.5, 157.5, 172.5],
  [190, 62.5, 95, 125, 140, 160, 175],
  [192, 62.5, 97.5, 125, 142.5, 160, 177.5],
  [195, 62.5, 97.5, 127.5, 145, 160, 180],
  [197, 65, 100, 130, 145, 162.5, 182.5],
  [199, 65, 100, 130, 147.5, 165, 182.5],
  [201, 65, 102.5, 132.5, 150, 167.5, 182.5],
  [204, 67.5, 102.5, 135, 152.5, 170, 185],
  [206, 60, 92.5, 125, 150, 172.5, 187.5],
  [208, 60, 92.5, 125, 150, 172.5, 190],
  [210, 60, 95, 127.5, 152.5, 175, 192.5],
  [213, 60, 95, 127.5, 155, 177.5, 195],
  [215, 62.5, 97.5, 130, 155, 180, 197.5],
  [217, 62.5, 97.5, 132.5, 157.5, 182.5, 200],
  [219, 62.5, 100, 132.5, 160, 182.5, 202.5],
  [222, 62.5, 100, 135, 160, 182.5, 205],
  [224, 65, 102.5, 135, 160, 185, 207.5],
  [226, 65, 102.5, 135, 162.5, 187.5, 207.5],
  [229, 65, 102.5, 137.5, 165, 190, 207.5],
  [231, 67.5, 105, 137.5, 165, 192.5, 210],
  [233, 67.5, 105, 140, 167.5, 192.5, 212.5],
  [235, 67.5, 107.5, 140, 170, 195, 215],
  [238, 67.5, 107.5, 142.5, 172.5, 197.5, 217.5],
  [240, 70, 110, 145, 172.5, 200, 220],
  [242, 70, 110, 145, 175, 202.5, 222.5],
  [244, 70, 110, 147.5, 177.5, 205, 225],
  [247, 72.5, 110, 147.5, 177.5, 205, 227.5],
  [249, 72.5, 112.5, 150, 180, 207.5, 230],
  [251, 60, 112.5, 145, 177.5, 200, 220, 232.5],
  [254, 60, 112.5, 147.5, 177.5, 200, 220, 235],
  [256, 60, 115, 150, 180, 202.5, 222.5, 237.5],
  [258, 60, 115, 150, 182.5, 205, 225, 240],
  [260, 62.5, 117.5, 152.5, 182.5, 207.5, 227.5, 242.5],
  [263, 62.5, 117.5, 152.5, 182.5, 207.5, 230, 245],
  [265, 62.5, 120, 155, 185, 207.5, 232.5, 247.5],
  [267, 62.5, 120, 155, 187.5, 210, 232.5, 250],
  [269, 65, 122.5, 157.5, 187.5, 212.5, 235, 252.5],
  [272, 65, 122.5, 160, 190, 215, 235, 255],
  [274, 65, 122.5, 160, 192.5, 217.5, 237.5, 257.5],
  [276, 65, 125, 160, 192.5, 217.5, 240, 257.5],
  [278, 67.5, 125, 160, 195, 220, 242.5, 257.5],
  [281, 67.5, 127.5, 162.5, 197.5, 222.5, 245, 260],
  [283, 67.5, 127.5, 165, 200, 225, 247.5, 262.5],
  [285, 67.5, 130, 165, 200, 227.5, 250, 265],
  [288, 67.5, 130, 167.5, 202.5, 227.5, 250, 267.5],
  [290, 70, 132.5, 167.5, 205, 230, 252.5, 270],
  [292, 70, 132.5, 170, 205, 232.5, 255, 272.5],
  [294, 70, 135, 170, 207.5, 232.5, 257.5, 275],
  [297, 65, 97.5, 132.5, 160, 192.5, 227.5, 257.5, 277.5],
  [299, 65, 100, 132.5, 160, 195, 227.5, 260, 280],
  [301, 65, 100, 135, 162.5, 195, 230, 262.5, 280],
  [303, 65, 100, 135, 162.5, 197.5, 232.5, 265, 282.5],
  [306, 67.5, 102.5, 135, 165, 200, 232.5, 265, 285],
  [308, 67.5, 102.5, 135, 165, 200, 232.5, 267.5, 287.5],
  [310, 67.5, 102.5, 135, 167.5, 202.5, 235, 270, 290],
  [312, 67.5, 105, 137.5, 170, 205, 237.5, 272.5, 292.5],
  [315, 70, 105, 137.5, 170, 205, 240, 275, 295],
  [317, 70, 105, 140, 172.5, 207.5, 240, 277.5, 297.5],
  [319, 70, 107.5, 140, 172.5, 207.5, 242.5, 280, 300],
  [322, 70, 107.5, 140, 175, 207.5, 245, 280, 300],
  [324, 70, 107.5, 142.5, 175, 210, 247.5, 280, 302.5],
  [326, 72.5, 110, 142.5, 177.5, 212.5, 247.5, 282.5, 305],
  [328, 72.5, 110, 145, 177.5, 212.5, 250, 285, 305],
  [331, 72.5, 110, 145, 180, 215, 252.5, 287.5, 307.5],
  [333, 72.5, 110, 147.5, 180, 217.5, 255, 290, 310],
  [335, 75, 110, 147.5, 182.5, 217.5, 255, 292.5, 312.5],
  [337, 75, 110, 150, 182.5, 220, 257.5, 295, 315],
  [340, 75, 112.5, 150, 182.5, 222.5, 257.5, 297.5, 317.5],
  [342, 60, 102.5, 135, 175, 220, 255, 295, 317.5],
  [344, 60, 105, 137.5, 177.5, 220, 255, 297.5, 320],
  [346, 62.5, 105, 137.5, 177.5, 222.5, 257.5, 300, 322.5],
  [349, 62.5, 105, 140, 180, 225, 257.5, 300, 322.5],
  [351, 62.5, 107.5, 140, 180, 225, 260, 302.5, 325],
  [353, 62.5, 107.5, 140, 182.5, 227.5, 260, 305, 327.5],
  [356, 62.5, 107.5, 142.5, 182.5, 227.5, 262.5, 305, 330],
  [358, 62.5, 107.5, 142.5, 182.5, 230, 265, 307.5, 330],
  [360, 65, 110, 145, 182.5, 232.5, 267.5, 310, 332.5],
  [362, 65, 110, 145, 185, 232.5, 267.5, 312.5, 335],
  [365, 65, 110, 145, 185, 232.5, 270, 312.5, 337.5],
  [367, 65, 110, 147.5, 187.5, 235, 272.5, 315, 340],
  [369, 65, 110, 147.5, 187.5, 235, 275, 317.5, 342.5],
  [371, 67.5, 110, 150, 190, 237.5, 275, 320, 345],
  [374, 67.5, 112.5, 150, 190, 240, 277.5, 322.5, 347.5],
  [376, 67.5, 112.5, 150, 192.5, 240, 280, 325, 350],
  [378, 67.5, 112.5, 152.5, 192.5, 242.5, 280, 327.5, 350],
  [381, 67.5, 112.5, 152.5, 195, 245, 280, 327.5, 352.5],
  [383, 67.5, 115, 155, 195, 245, 282.5, 330, 355],
  [385, 70, 115, 155, 197.5, 247.5, 285, 330, 355],
]

const Warmup = ({ opener, round }: { opener: number; round: number }) => {
  const tableTarget = table.reduce((acc, curr, idx, array) => {
    if (array[idx + 1]) {
      if (opener >= curr[0] && opener < array[idx + 1][0]) {
        acc = curr
      }
    }
    return acc
  }, table[table.length - 1])

  console.log('tableTarget', tableTarget)

  const range = () => {
    if (round === 1) return opener < 91 ? 'x 5-7' : 'x 8-10'
    if (round === 2) {
      if (opener < 91) return 'x 3-5'
      if (opener < 182) return 'x 4-7'
      if (opener < 273) return 'x 5-8'
      return 'x 8'
    }
    if (round === 3) {
      if (opener < 91) return 'x 1'
      if (opener < 182) return 'x 3'
      if (opener < 273) return 'x 3-5'
      return 'x 5'
    }
    if (round === 4) {
      if (opener < 114) return 'x 1'
      if (opener < 273) return 'x 2'
      return 'x 3'
    }
    if (round === 5) {
      if (opener < 157) return 'x 1'
      return 'x 1-2'
    }
    if (round === 6) {
      return 'x 1'
    }
    if (round === 7) {
      return 'x 1'
    }
    if (round === 8) {
      return 'x 1'
    }
    return null
  }

  if (!tableTarget[round]) return null

  return (
    <div className='flex flex-row gap-6 text-lg'>
      <div className='flex w-10 items-center text-2xl font-bold'>
        <div className=''>{round}</div>
      </div>
      <div className='flex items-center justify-center gap-2'>
        <div className='font-semibold'>{tableTarget[round]}kg</div>
        <div className=''>{range()}</div>
      </div>
    </div>
  )
}

const LiftCell = ({
  round,
  lift,
  p1,
  p2,
  p3,
}: {
  round: string
  lift: number
  p1: number
  p2: number
  p3: number
}) => {
  const lift1 = Math.round((lift * p1) / 2.5) * 2.5
  const lift2 = Math.round((lift * p2) / 2.5) * 2.5
  const lift3 = Math.round((lift * p3) / 2.5) * 2.5
  return (
    <div className='flex flex-row gap-6 text-lg'>
      <div className='flex w-10 items-center text-2xl font-bold'>
        <div className=''>{round}</div>
      </div>
      <div className='flex flex-col items-center justify-center gap-1'>
        <div className=''>{lift1 === lift2 ? lift1 - 2.5 : lift1}kg</div>
        <div className='font-bold text-yellow-500'>{lift2}kg</div>
        <div className=''>{lift3 === lift2 ? lift3 + 2.5 : lift3}kg</div>
      </div>
      <div className='flex flex-col items-center justify-center gap-1 font-light text-gray-400'>
        <div className=''>{p1 * 100}%</div>
        <div className=''>{p2 * 100}%</div>
        <div className=''>{p3 * 100}%</div>
      </div>
    </div>
  )
}

const Lift = ({ lift, target }: { lift: string; target: number }) => {
  const opener = Math.round((target * 0.91) / 2.5) * 2.5
  return (
    <div className='flex flex-col gap-4'>
      <h2 className='text-2xl font-bold'>{lift}</h2>
      <LiftCell
        round='1st'
        lift={target}
        p1={0.9}
        p2={0.91}
        p3={0.92}
      />
      <LiftCell
        round='2nd'
        lift={target}
        p1={0.95}
        p2={0.96}
        p3={0.97}
      />
      <LiftCell
        round='3rd'
        lift={target}
        p1={0.99}
        p2={1}
        p3={1.02}
      />
      <h2 className='text-2xl font-bold'>Warmup</h2>
      <Warmup
        opener={opener}
        round={1}
      />
      <Warmup
        opener={opener}
        round={2}
      />
      <Warmup
        opener={opener}
        round={3}
      />
      <Warmup
        opener={opener}
        round={4}
      />
      <Warmup
        opener={opener}
        round={5}
      />
      <Warmup
        opener={opener}
        round={6}
      />
      <Warmup
        opener={opener}
        round={7}
      />
      <Warmup
        opener={opener}
        round={8}
      />
    </div>
  )
}

const CompAttempts = ({ userId }: { userId: string }) => {
  const { data: session } = useSession()
  const user = session?.user
  const { data: userInfo } = api.settings.get.useQuery({
    userId: userId,
  })

  console.log('userInfo', userInfo)

  if (!userInfo) return null
  if (!user) return null

  const squat = userInfo.squatOneRepMax || 0
  const bench = userInfo.benchOneRepMax || 0
  const deadlift = userInfo.deadliftOneRepMax || 0

  return (
    <div className='flex flex-col gap-12 p-4 text-lg font-medium'>
      <h1 className='text-2xl font-bold'>CompAttempts</h1>
      {squat !== 0 && (
        <Lift
          lift='Squat'
          target={+squat}
        />
      )}
      {bench !== 0 && (
        <Lift
          lift='Bench'
          target={+bench}
        />
      )}
      {deadlift !== 0 && (
        <Lift
          lift='Deadlift'
          target={+deadlift}
        />
      )}
    </div>
  )
}

export default CompAttempts
